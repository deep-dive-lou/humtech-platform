<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Request — HumTech Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

  <!-- Header -->
  <div class="bg-white border-b border-gray-200 sticky top-0 z-10">
    <div class="max-w-3xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="/portal/staff/requests" class="text-sm text-gray-400 hover:text-gray-900">← Requests</a>
        <span class="text-gray-200">|</span>
        <h1 class="text-lg font-semibold">New Request</h1>
      </div>
      <a href="/portal/staff/logout" class="text-sm text-gray-500 hover:text-gray-900">Sign out</a>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-6 py-8">
    <form method="POST" action="/portal/staff/requests" class="space-y-6">

      <!-- Client details -->
      <div class="bg-white rounded-xl border border-gray-200 p-5">
        <h2 class="text-sm font-semibold mb-4">Client details</h2>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Full name <span class="text-red-400">*</span></label>
            <input
              type="text"
              name="full_name"
              required
              placeholder="Jane Smith"
              class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900"
            />
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Email <span class="text-red-400">*</span></label>
            <input
              type="email"
              name="email"
              required
              placeholder="jane@example.com"
              class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900"
            />
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Phone</label>
            <input
              type="tel"
              name="phone"
              placeholder="+44 7700 000000"
              class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900"
            />
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Due date</label>
            <input
              type="date"
              name="due_at"
              class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900"
            />
          </div>
        </div>
      </div>

      <!-- Template selection -->
      <div class="bg-white rounded-xl border border-gray-200 p-5">
        <h2 class="text-sm font-semibold mb-4">Document checklist</h2>

        <div class="mb-4">
          <label class="block text-xs font-medium text-gray-600 mb-1">Template</label>
          <select
            name="template_id"
            id="template-select"
            onchange="loadPreview(this.value)"
            class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white"
          >
            <option value="">No template — create manually later</option>
            {% for t in templates %}
            <option value="{{ t.id }}">{{ t.name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Preview panel -->
        <div id="template-preview" class="hidden">
          <p class="text-xs font-medium text-gray-500 mb-2">Items that will be added:</p>
          <div id="preview-items" class="space-y-1"></div>
        </div>

        {% if not templates %}
        <p class="text-xs text-gray-400 mt-2">
          No templates yet.
          <a href="/portal/staff/templates/new" class="underline hover:text-gray-700">Create one</a>
          to speed up future requests.
        </p>
        {% endif %}
      </div>

      <div class="flex items-center gap-3">
        <button
          type="submit"
          class="text-sm font-medium bg-gray-900 text-white px-5 py-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          Create request
        </button>
        <a href="/portal/staff/requests" class="text-sm text-gray-500 hover:text-gray-900">Cancel</a>
      </div>

    </form>
  </div>

  <script>
    async function loadPreview(templateId) {
      const panel = document.getElementById('template-preview');
      const list  = document.getElementById('preview-items');
      if (!templateId) {
        panel.classList.add('hidden');
        list.innerHTML = '';
        return;
      }
      const res = await fetch(`/portal/staff/templates/${templateId}/items`);
      if (!res.ok) { panel.classList.add('hidden'); return; }
      const items = await res.json();
      list.innerHTML = items.map(i =>
        `<div class="flex items-center gap-2 text-xs text-gray-600">
          <span class="w-4 h-4 rounded-full border-2 border-gray-300 flex-shrink-0 inline-block"></span>
          ${escHtml(i.title)}
          ${i.required ? '' : '<span class="text-gray-400">(optional)</span>'}
        </div>`
      ).join('');
      panel.classList.toggle('hidden', items.length === 0);
    }

    function escHtml(str) {
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
  </script>
</body>
</html>
